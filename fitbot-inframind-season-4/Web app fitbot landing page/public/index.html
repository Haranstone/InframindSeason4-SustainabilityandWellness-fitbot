<!--Hello tcser i have added some comments for the code for your understanding and i have removed my application credentials, since i have added repo on github but if you need them for testing mail me at 'haranshinobi@gmail.com' thank you.-->

<!doctype html>
<html>
  <head>
    <title>Welcome to fitbit</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <style type="text/css">
      #login, #loggedin {
        display: none;
      }
      .text-overflow {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 500px;
      }

      .center {
  display: block;
  margin-left: auto;
  margin-right: 100;
  width: 50%;
}

    </style>
  </head>

  <body>
    <link rel="stylesheet" href="./styles.css">
    <!-- partial:index.partial.html -->
<div id="container">
  <!--This below code is for navbar in the fitbot landing page -->
  <nav class="navbar">
    <a href='https://www.fitbit.com/global/us/home'>Home</a>
    <a href='https://www.fitbit.com/global/us/about-us'>About</a>
    <a href='https://www.fitbit.com/global/us/products'>Products</a>
    <a href='https://www.fitbit.com/in/inspire'>Features</a>
    <a href="https://store-in.fitbit.com/products.php?family=inspire2">Buy Now</a>
  </nav>
  <!--Nav bar code ends -->
  <div id="background"></div>
<!--This below code is for the body text in fitbot home page-->
  <div class="section">
   <h1 id="title" class="margin-top">Fitbit Inspire</h1>
   <!--<h2 class="less-margin">a <span class="highlight">wristband</span> that lets you </h2><h2>wear fitness <span class="highlight">your way</span>.</h2>-->
   <div class="container" class="center">
    <div id="login" >
      <h1>Hello there !</h1>
      <!--This below single line code is for fitbit login button -->
         <a href="/login" class="btn btn-primary" >Log in with <b>Fitbit</b></a>
    </div>
    <div id="loggedin">
      <div id="user-profile">
      </div>
      <div id="oauth">
      </div>
      <!--<button class="btn btn-default" id="obtain-new-token">Obtain new token using the refresh token</button>-->
    </div>
  </div><br><br>
  <!--This below code is to change theme color based on the user preference in the fitbot landing page -->
  <div class="alta">
    <!--<img id="alta" src="https://marketing-pages.fitbit.com/images/product-listing/desktop/altahr-coral-silver-tpu-regular-0-2d30e3c8ded88413047136b8c97e06bc.png">-->
    <div class="button rosegold" id="rosegold" onclick="rosegoldColor()"></div>
    <div class="button coral" id="coral" onclick="coralColor()"></div>
    <div class="button fuschia" id="fuschia" onclick="fuschiaColor()"></div>
    <div class="button black" id="black" onclick="goldColor()"></div>
   </div>
 </div>
  <p id="desc">Fitbit motivates you to reach your health and fitness goals by tracking your <br>activity, exercise, sleep, weight and more.</p>
</div>
<!-- partial -->
  <script  src="./scripts.js"></script>
  <!--The login homepage of fitbot ends here-->
<!--The logged on homepage of fitbot starts below-->
    <script id="user-profile-template" type="text/x-handlebars-template">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
      <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
      <link rel='stylesheet' href='https://andrelzgava.github.io/font-awesome-extension/styles.css'><link rel="stylesheet" href="./style.css">
      <body>
      <!-- This below code contains a animation created with css and js to render the fitbit device in logged in page -->
      <div class="fitbit">
        <div class="wrapper">
          <div class="display">
            <div class="slider">
              <div class="slide active">
                <i class="fa fa-clock-o"></i>
                <div>Chat</div>
              </div>
              <div class="slide">
                <i class="fa fae-footprint"></i>
                <div>3382</div>
              </div>
              <div class="slide">
                <i class="fa fa-heartbeat"></i>
                <div>72</div>
              </div>
              <div class="slide">
                <i class="fa fa-map-marker"></i>
                <div>2.5M</div>
              </div>
              <div class="slide">
                <i class="fa fa-fire"></i>
                <div>120</div>
              </div>
            </div>
          </div>
          <button></button>
        </div>
        <div class="info">Your Fitbit device is Connected</div>
      </div>
      <!--The animation code of fitbot ends here-->
      <!--The logged on homepage details of a user code starts-->
      <h1>Logged in as {{user.displayName}}</h1>
      <div class="media">
        <div class="pull-left">
          <img class="media-object" width="150" src="{{images.0.url}}" />
        </div>
        <div class="media-body">
          <dl class="dl-horizontal">
            <dt>Full name</dt><dd class="clearfix">{{user.fullName}}</dd>
            <dt>Unique Id</dt><dd>{{user.encodedId}}</dd>
          </dl>
        </div>
      </div>
      <!--The logged on homepage details of a user code ends-->
      <!--This below script code links the fitbot animation js functions-->
      <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script><script  src="./script.js"></script>
      </body>
    </script>
    <!--The logged on homepage of fitbot ends-->


    <script id="oauth-template" type="text/x-handlebars-template">
    </script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <!--The wholesome JS code starts here-->
    <script>
      //the below function helps us to extract parameters from the fitbit O auth 2.0 
      (function() {

        
        function getHashParams() {
          var hashParams = {};
          var e, r = /([^&;=]+)=?([^&;]*)/g,
              q = window.location.hash.substring(1);
          while ( e = r.exec(q)) {
             hashParams[e[1]] = decodeURIComponent(e[2]);
          }
          return hashParams;
        }
        //passing the values to the html elements through ID this below code provides required details for login
        var userProfileSource = document.getElementById('user-profile-template').innerHTML,
            userProfileTemplate = Handlebars.compile(userProfileSource),
            userProfilePlaceholder = document.getElementById('user-profile');
        //used to retrieve accesstoken and refresh token from O auth 2.0
        var oauthSource = document.getElementById('oauth-template').innerHTML,
            oauthTemplate = Handlebars.compile(oauthSource),
            oauthPlaceholder = document.getElementById('oauth');

        var params = getHashParams();
// extracting the access token and refresh token and storing it in variables to use inside the below functions
        var access_token = params.access_token,
            refresh_token = params.refresh_token,
            error = params.error;

        if (error) {
          alert('There was an error during the authentication');
        } else {
          if (access_token) {
            // render oauth info
            oauthPlaceholder.innerHTML = oauthTemplate({
              access_token: access_token,
              refresh_token: refresh_token
            });
//ajax request to the fitbit web api to get user profile data
            $.ajax({
                url: 'https://api.fitbit.com/1/user/-/profile.json',
                headers: {
                  'Authorization': 'Bearer ' + access_token
                },
                success: function(response) {
                  userProfilePlaceholder.innerHTML = userProfileTemplate(response);

                  $('#login').hide();
                  $('#loggedin').show();
                }
            });
          } else {
              // render initial screen
              $('#login').show();
              $('#loggedin').hide();
          }

          document.getElementById('obtain-new-token').addEventListener('click', function() {
            $.ajax({
              url: '/refresh_token',
              data: {
                'refresh_token': refresh_token
              }
            }).done(function(data) {
              access_token = data.access_token;
              oauthPlaceholder.innerHTML = oauthTemplate({
                access_token: access_token,
                refresh_token: refresh_token
              });
            });
          }, false);
        }
      })();
    </script>
  <!--This below code is from dialogflow console messenger integration-->
    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
    <df-messenger
      intent="WELCOME"
      chat-title="Inframind"
      agent-id="d6c6ed7e-3542-48bc-8512-a134e08ef4aa"
      language-code="en"
    ></df-messenger>
  </body>
</html>

